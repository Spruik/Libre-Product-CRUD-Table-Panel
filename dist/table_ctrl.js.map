{"version":3,"sources":["../src/table_ctrl.js"],"names":["_","$","MetricsPanelCtrl","transformDataToTable","tablePanelEditor","columnOptionsTab","TableRenderer","utils","add","productGroup","product","panelDefaults","targets","transform","pageSize","showHeader","styles","type","pattern","alias","dateFormat","headerColor","unit","decimals","colors","colorMode","thresholds","columns","scroll","fontSize","sort","col","desc","TableCtrl","$scope","$injector","templateSrv","annotationsSrv","$sanitize","variableSrv","pageIndex","ctrl","panel","fields","defaults","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","currentFilterGroup","document","off","e","rowData","map","index","td","childNodes","length","nodeValue","text","currentProduct","findProductById","products","showProductOptionsModal","addEditorTab","actions","push","click","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","data","annotations","err","dataRaw","render","dataList","undefined","alert","productGroups","productGroupsFilter","rows","flat","splice","getRestructuredProduct","productDimension","getDimension","dataRawUnChange","copy","showAddOptionsModal","showProductGroupOptionsModal","filter","row","indexOf","refresh","table","renderer","isTimezoneUtc","colIndex","scope","$new","tableData","render_values","publishAppEvent","templateHtml","modalClass","elem","attrs","pageCount","getTableHeight","panelHeight","height","appendTableRows","tbodyElem","setTable","empty","html","switchPage","el","currentTarget","parseInt","renderPanel","appendPaginationControls","footerElem","Math","ceil","startPage","max","endPage","min","paginationList","i","activeClass","pageLinkElem","append","panelElem","parents","rootElem","find","css","addClass","tooltip","selector","addFilterClicked","filterData","options","key","column","value","operator","setAdhocFilter","unbindDestroy","$on","renderData","renderingCompleted","templateUrl"],"mappings":"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","file":"table_ctrl.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport {transformDataToTable} from './transformers';\nimport {tablePanelEditor} from './editor';\nimport {columnOptionsTab} from './column_options';\nimport {TableRenderer} from './renderer';\nimport * as utils from './utils'\nimport * as add from './add_options'\nimport * as productGroup from './product_group_options'\nimport * as product from './product_options'\n\nimport './css/style.css!';\nimport './css/instant-serach.css!';\n\nconst panelDefaults = {\n  targets: [{}],\n  transform: 'timeseries_to_columns',\n  pageSize: null,\n  showHeader: true,\n  styles: [\n    {\n      type: 'date',\n      pattern: 'Time',\n      alias: 'Time',\n      dateFormat: 'YYYY-MM-DD HH:mm:ss',\n      headerColor: \"rgba(51, 181, 229, 1)\"\n    },\n    {\n      unit: 'short',\n      type: 'number',\n      alias: '',\n      decimals: 2,\n      headerColor: \"rgba(51, 181, 229, 1)\",\n      colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\n      colorMode: null,\n      pattern: '/.*/',\n      thresholds: [],\n    }\n  ],\n  columns: [],\n  scroll: true,\n  fontSize: '100%',\n  sort: { col: 0, desc: true },\n};\n\nexport class TableCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, templateSrv, annotationsSrv, $sanitize, variableSrv) {\n    super($scope, $injector);\n\n    this.pageIndex = 0;\n    let ctrl = this\n\n    if (this.panel.styles === void 0) {\n      this.panel.styles = this.panel.columns;\n      this.panel.columns = this.panel.fields;\n      delete this.panel.columns;\n      delete this.panel.fields;\n    }\n\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n\n    this.currentFilterGroup = 'All'\n\n    $(document).off('click', 'tr.tr-affect#master-data-product-tr')\n    $(document).on('click', 'tr.tr-affect#master-data-product-tr', function (e) {\n      const rowData = $('td', this).map((index, td)=>{\n        if (td.childNodes.length === 2) {\n          return td.childNodes[1].nodeValue\n        }else if (td.childNodes.length === 1) {\n          return $(td).text()\n        }else {\n          return ''\n        }\n      })\n      $scope.ctrl.currentProduct = utils.findProductById($scope.ctrl.products, rowData[1])[0]\n      product.showProductOptionsModal($scope.ctrl)\n    })\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', tablePanelEditor, 2);\n    this.addEditorTab('Column Styles', columnOptionsTab, 3);\n  }\n\n  onInitPanelActions(actions) {\n    actions.push({ text: 'Export CSV', click: 'ctrl.exportCsv()' });\n  }\n\n  issueQueries(datasource) {\n    this.pageIndex = 0;\n\n    if (this.panel.transform === 'annotations') {\n      this.setTimeQueryStart();\n      return this.annotationsSrv\n        .getAnnotations({\n          dashboard: this.dashboard,\n          panel: this.panel,\n          range: this.range,\n        })\n        .then(annotations => {\n          return { data: annotations };\n        });\n    }\n\n    return super.issueQueries(datasource);\n  }\n\n  onDataError(err) {\n    this.dataRaw = [];\n    this.render();\n  }\n\n  onDataReceived(dataList) {\n\n    if (dataList.length === 0 || dataList === null || dataList === undefined) {\n      return\n    }\n\n    if (dataList[0].type !== 'table') {\n      utils.alert('error', 'Error', 'To show the product list, please format data as a TABLE in the Metrics Setting')\n      return\n    }\n\n    this.productGroups = []\n    this.productGroupsFilter = []\n\n    if (dataList[1]) {\n      if (dataList[1].type !== 'table') {\n        utils.alert('error', 'Error', 'To show the product list, please format data as a TABLE in the Metrics Setting')\n        return\n      }\n\n      this.productGroups = dataList[1].rows.flat().sort()\n      this.productGroupsFilter = dataList[1].rows.flat().sort()\n    }\n\n    this.productGroupsFilter.splice(0, 0, 'All')\n\n    this.products = utils.getRestructuredProduct(dataList[0].columns, dataList[0].rows)\n    this.productDimension = utils.getDimension(dataList[0].columns)\n    \n    this.dataRaw = dataList;\n    this.dataRawUnChange = utils.copy(dataList)\n    this.pageIndex = 0;\n    // automatically correct transform mode based on data\n    if (this.dataRaw && this.dataRaw.length) {\n      if (this.dataRaw[0].type === 'table') {\n        this.panel.transform = 'table';\n      } else {\n        if (this.dataRaw[0].type === 'docs') {\n          this.panel.transform = 'json';\n        } else {\n          if (this.panel.transform === 'table' || this.panel.transform === 'json') {\n            this.panel.transform = 'timeseries_to_rows';\n          }\n        }\n      }\n    }\n    this.render();\n  }\n\n  onAddButtonClick() {\n    add.showAddOptionsModal(this)\n  }\n\n  onProductGroupButtonClick() {\n    productGroup.showProductGroupOptionsModal(this)\n  }\n\n  onGroupFilterChange() {\n\n    this.dataRaw[0].rows = this.dataRawUnChange[0].rows\n\n    if(this.currentFilterGroup !== 'All') {\n      this.dataRaw[0].rows = this.dataRaw[0].rows.filter(row => row[this.productDimension.indexOf('product_group')] === this.currentFilterGroup)\n    }else {\n      this.refresh()\n    }\n\n    this.render()\n  }\n\n  render() {\n    this.table = transformDataToTable(this.dataRaw, this.panel);\n    // console.log(this.panel.sort);\n    this.table.sort(this.panel.sort);\n    // console.log(this.panel.sort);\n    this.renderer = new TableRenderer(\n      this.panel,\n      this.table,\n      this.dashboard.isTimezoneUtc(),\n      this.$sanitize,\n      this.templateSrv,\n      this.col\n    );\n\n    return super.render(this.table);\n  }\n\n  toggleColumnSort(col, colIndex) {\n    // remove sort flag from current column\n    if (this.table.columns[this.panel.sort.col]) {\n      this.table.columns[this.panel.sort.col].sort = false;\n    }\n\n    if (this.panel.sort.col === colIndex) {\n      if (this.panel.sort.desc) {\n        this.panel.sort.desc = false;\n      } else {\n        this.panel.sort.col = null;\n      }\n    } else {\n      this.panel.sort.col = colIndex;\n      this.panel.sort.desc = true;\n    }\n    this.render();\n  }\n\n  exportCsv() {\n    const scope = this.$scope.$new(true);\n    scope.tableData = this.renderer.render_values();\n    scope.panel = 'table';\n    this.publishAppEvent('show-modal', {\n      templateHtml: '<export-data-modal panel=\"panel\" data=\"tableData\"></export-data-modal>',\n      scope,\n      modalClass: 'modal--narrow',\n    });\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    let data;\n    const panel = ctrl.panel;\n    let pageCount = 0;\n\n    function getTableHeight() {\n      let panelHeight = ctrl.height;\n\n      if (pageCount > 1) {\n        panelHeight -= 26;\n      }\n\n      return panelHeight - 31 + 'px';\n    }\n\n    function appendTableRows(tbodyElem) {\n      ctrl.renderer.setTable(data);\n      tbodyElem.empty();\n      tbodyElem.html(ctrl.renderer.render(ctrl.pageIndex));\n    }\n\n    function switchPage(e) {\n      const el = $(e.currentTarget);\n      ctrl.pageIndex = parseInt(el.text(), 10) - 1;\n      renderPanel();\n    }\n\n    function appendPaginationControls(footerElem) {\n      footerElem.empty();\n\n      const pageSize = panel.pageSize || 100;\n      pageCount = Math.ceil(data.rows.length / pageSize);\n      if (pageCount === 1) {\n        return;\n      }\n\n      const startPage = Math.max(ctrl.pageIndex - 3, 0);\n      const endPage = Math.min(pageCount, startPage + 9);\n\n      const paginationList = $('<ul></ul>');\n\n      for (let i = startPage; i < endPage; i++) {\n        const activeClass = i === ctrl.pageIndex ? 'active' : '';\n        const pageLinkElem = $(\n          '<li><a class=\"table-panel-page-link pointer ' + activeClass + '\">' + (i + 1) + '</a></li>'\n        );\n        paginationList.append(pageLinkElem);\n      }\n\n      footerElem.append(paginationList);\n    }\n\n    function renderPanel() {\n      const panelElem = elem.parents('.panel-content');\n      const rootElem = elem.find('.table-panel-scroll');\n      const tbodyElem = elem.find('tbody');\n      const footerElem = elem.find('.table-panel-footer');\n\n      elem.css({ 'font-size': panel.fontSize });\n      panelElem.addClass('table-panel-content');\n\n      appendTableRows(tbodyElem);\n      appendPaginationControls(footerElem);\n\n      rootElem.css({ 'max-height': panel.scroll ? getTableHeight() : '' });\n    }\n\n    // hook up link tooltips\n    elem.tooltip({\n      selector: '[data-link-tooltip]',\n    });\n\n    function addFilterClicked(e) {\n      const filterData = $(e.currentTarget).data();\n      const options = {\n        datasource: panel.datasource,\n        key: data.columns[filterData.column].text,\n        value: data.rows[filterData.row][filterData.column],\n        operator: filterData.operator,\n      };\n\n      ctrl.variableSrv.setAdhocFilter(options);\n    }\n\n    elem.on('click', '.table-panel-page-link', switchPage);\n    elem.on('click', '.table-panel-filter-link', addFilterClicked);\n\n    const unbindDestroy = scope.$on('$destroy', () => {\n      elem.off('click', '.table-panel-page-link');\n      elem.off('click', '.table-panel-filter-link');\n      unbindDestroy();\n    });\n\n    ctrl.events.on('render', renderData => {\n      data = renderData || data;\n      if (data) {\n        renderPanel();\n      }\n      ctrl.renderingCompleted();\n    });\n  }\n\n}\n\nTableCtrl.templateUrl = './partials/module.html';\n"]}