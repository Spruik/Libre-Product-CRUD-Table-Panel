{"version":3,"sources":["../src/table_ctrl.js"],"names":["_","$","MetricsPanelCtrl","transformDataToTable","tablePanelEditor","columnOptionsTab","TableRenderer","utils","add","productGroup","product","panelDefaults","targets","transform","pageSize","showHeader","styles","type","pattern","alias","dateFormat","headerColor","unit","decimals","colors","colorMode","thresholds","columns","scroll","fontSize","sort","col","desc","TableCtrl","$scope","$injector","templateSrv","annotationsSrv","$sanitize","variableSrv","pageIndex","ctrl","panel","fields","defaults","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","currentFilterGroup","document","off","e","rowData","map","index","td","childNodes","length","nodeValue","text","idIndex","colDimensions","indexOf","alert","currentProduct","findProductById","products","showProductOptionsModal","addEditorTab","actions","push","click","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","data","annotations","dataRaw","render","dataList","undefined","productGroups","productGroupsFilter","rows","flat","materials","getRestructuredData","materialsDataList","reduce","arr","mat","item","name","description","operationSeq","operationSeqList","x","splice","getRestructuredProduct","productDimension","getDimension","dataRawUnChange","copy","onGroupFilterChange","showAddOptionsModal","showProductGroupOptionsModal","filter","row","table","renderer","isTimezoneUtc","colIndex","scope","$new","tableData","render_values","publishAppEvent","templateHtml","modalClass","elem","attrs","pageCount","getTableHeight","panelHeight","height","appendTableRows","tbodyElem","setTable","empty","html","switchPage","el","currentTarget","parseInt","renderPanel","appendPaginationControls","footerElem","Math","ceil","startPage","max","endPage","min","paginationList","i","activeClass","pageLinkElem","append","panelElem","parents","rootElem","find","css","addClass","split","hidden","tooltip","selector","addFilterClicked","filterData","options","key","column","value","operator","setAdhocFilter","unbindDestroy","$on","renderData","renderingCompleted","templateUrl"],"mappings":"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","file":"table_ctrl.js","sourcesContent":["import _ from 'lodash'\r\nimport $ from 'jquery'\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk'\r\nimport { transformDataToTable } from './transformers'\r\nimport { tablePanelEditor } from './editor'\r\nimport { columnOptionsTab } from './column_options'\r\nimport { TableRenderer } from './renderer'\r\nimport * as utils from './utils'\r\nimport * as add from './add_options'\r\nimport * as productGroup from './product_group_options'\r\nimport * as product from './product_options'\r\n\r\nimport './css/style.css!'\r\nimport './css/instant-serach.css!'\r\n\r\nconst panelDefaults = {\r\n  targets: [{}],\r\n  transform: 'timeseries_to_columns',\r\n  pageSize: null,\r\n  showHeader: true,\r\n  styles: [\r\n    {\r\n      type: 'date',\r\n      pattern: 'Time',\r\n      alias: 'Time',\r\n      dateFormat: 'YYYY-MM-DD HH:mm:ss',\r\n      headerColor: 'rgba(51, 181, 229, 1)'\r\n    },\r\n    {\r\n      unit: 'short',\r\n      type: 'number',\r\n      alias: '',\r\n      decimals: 2,\r\n      headerColor: 'rgba(51, 181, 229, 1)',\r\n      colors: ['rgba(245, 54, 54, 0.9)', 'rgba(237, 129, 40, 0.89)', 'rgba(50, 172, 45, 0.97)'],\r\n      colorMode: null,\r\n      pattern: '/.*/',\r\n      thresholds: []\r\n    }\r\n  ],\r\n  columns: [],\r\n  scroll: true,\r\n  fontSize: '100%',\r\n  sort: { col: 0, desc: true }\r\n}\r\n\r\nexport class TableCtrl extends MetricsPanelCtrl {\r\n  constructor ($scope, $injector, templateSrv, annotationsSrv, $sanitize, variableSrv) {\r\n    super($scope, $injector)\r\n\r\n    this.pageIndex = 0\r\n    const ctrl = this\r\n\r\n    if (this.panel.styles === void 0) {\r\n      this.panel.styles = this.panel.columns\r\n      this.panel.columns = this.panel.fields\r\n      delete this.panel.columns\r\n      delete this.panel.fields\r\n    }\r\n\r\n    _.defaults(this.panel, panelDefaults)\r\n\r\n    this.events.on('data-received', this.onDataReceived.bind(this))\r\n    this.events.on('data-error', this.onDataError.bind(this))\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this))\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this))\r\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this))\r\n\r\n    this.currentFilterGroup = 'All'\r\n\r\n    $(document).off('click', 'tr.tr-affect#master-data-product-tr')\r\n    $(document).on('click', 'tr.tr-affect#master-data-product-tr', function (e) {\r\n      const rowData = $('td', this).map((index, td) => {\r\n        if (td.childNodes.length === 2) {\r\n          return td.childNodes[1].nodeValue\r\n        } else if (td.childNodes.length === 1) {\r\n          return $(td).text()\r\n        } else {\r\n          return ''\r\n        }\r\n      })\r\n\r\n      const idIndex = $scope.ctrl.colDimensions.indexOf('id')\r\n      if (!~idIndex) {\r\n        utils.alert('error', 'Error', 'Get not get this product from the database because PRODUCT ID NOT FOUND, please contact the dev team or try to NOT hide the product id column')\r\n      } else {\r\n        $scope.ctrl.currentProduct = utils.findProductById($scope.ctrl.products, rowData[idIndex])[0]\r\n        product.showProductOptionsModal($scope.ctrl)\r\n      }\r\n    })\r\n  }\r\n\r\n  onInitEditMode () {\r\n    this.addEditorTab('Options', tablePanelEditor, 2)\r\n    this.addEditorTab('Column Styles', columnOptionsTab, 3)\r\n  }\r\n\r\n  onInitPanelActions (actions) {\r\n    actions.push({ text: 'Export CSV', click: 'ctrl.exportCsv()' })\r\n  }\r\n\r\n  issueQueries (datasource) {\r\n    this.pageIndex = 0\r\n\r\n    if (this.panel.transform === 'annotations') {\r\n      this.setTimeQueryStart()\r\n      return this.annotationsSrv\r\n        .getAnnotations({\r\n          dashboard: this.dashboard,\r\n          panel: this.panel,\r\n          range: this.range\r\n        })\r\n        .then(annotations => {\r\n          return { data: annotations }\r\n        })\r\n    }\r\n\r\n    return super.issueQueries(datasource)\r\n  }\r\n\r\n  onDataError () {\r\n    this.dataRaw = []\r\n    this.render()\r\n  }\r\n\r\n  onDataReceived (dataList) {\r\n    if (dataList.length === 0 || dataList === null || dataList === undefined) {\r\n      return\r\n    }\r\n\r\n    if (dataList[0].type !== 'table') {\r\n      utils.alert('error', 'Error', 'To show the product list, please format data as a TABLE in the Metrics Setting')\r\n      return\r\n    }\r\n\r\n    this.productGroups = []\r\n    this.productGroupsFilter = []\r\n\r\n    if (dataList[1]) {\r\n      if (dataList[1].type !== 'table') {\r\n        utils.alert('error', 'Error', 'To show the product list, please format data as a TABLE in the Metrics Setting')\r\n        return\r\n      }\r\n\r\n      this.productGroups = dataList[1].rows.flat().sort()\r\n      this.productGroupsFilter = dataList[1].rows.flat().sort()\r\n    }\r\n\r\n    if (dataList[2]) {\r\n      if (dataList[2].type !== 'table') {\r\n        utils.alert('error', 'Error', 'To show the product list, please format data as a TABLE in the Metrics Setting')\r\n        return\r\n      }\r\n      this.materials = utils.getRestructuredData(dataList[2].columns, dataList[2].rows)\r\n      this.materialsDataList = this.materials.reduce((arr, mat) => {\r\n        const item = `${mat.name} | ${mat.description}`\r\n        arr.push(item)\r\n        return arr\r\n      }, [])\r\n    }\r\n\r\n    if (dataList[3]) {\r\n      if (dataList[3].type !== 'table') {\r\n        utils.alert('error', 'Error', 'To show the product list, please format data as a TABLE in the Metrics Setting')\r\n        return\r\n      }\r\n      this.operationSeq = utils.getRestructuredData(dataList[3].columns, dataList[3].rows)\r\n      this.operationSeqList = this.operationSeq.map(x => x.name)\r\n    }\r\n\r\n    this.productGroupsFilter.splice(0, 0, 'All')\r\n\r\n    this.products = utils.getRestructuredProduct(dataList[0].columns, dataList[0].rows)\r\n    this.productDimension = utils.getDimension(dataList[0].columns)\r\n\r\n    this.dataRaw = dataList\r\n    this.dataRawUnChange = utils.copy(dataList)\r\n    this.pageIndex = 0\r\n    // automatically correct transform mode based on data\r\n    if (this.dataRaw && this.dataRaw.length) {\r\n      if (this.dataRaw[0].type === 'table') {\r\n        this.panel.transform = 'table'\r\n      } else {\r\n        if (this.dataRaw[0].type === 'docs') {\r\n          this.panel.transform = 'json'\r\n        } else {\r\n          if (this.panel.transform === 'table' || this.panel.transform === 'json') {\r\n            this.panel.transform = 'timeseries_to_rows'\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.currentFilterGroup !== 'All') {\r\n      this.onGroupFilterChange()\r\n    }\r\n\r\n    this.render()\r\n  }\r\n\r\n  onAddButtonClick () {\r\n    add.showAddOptionsModal(this)\r\n  }\r\n\r\n  onProductGroupButtonClick () {\r\n    productGroup.showProductGroupOptionsModal(this)\r\n  }\r\n\r\n  onGroupFilterChange () {\r\n    this.dataRaw[0].rows = this.dataRawUnChange[0].rows\r\n\r\n    if (this.currentFilterGroup !== 'All') {\r\n      this.dataRaw[0].rows = this.dataRaw[0].rows.filter(row => row[this.productDimension.indexOf('product_group')] === this.currentFilterGroup)\r\n    }\r\n\r\n    this.render()\r\n  }\r\n\r\n  render () {\r\n    this.table = transformDataToTable(this.dataRaw, this.panel)\r\n    // console.log(this.panel.sort);\r\n    this.table.sort(this.panel.sort)\r\n    // console.log(this.panel.sort);\r\n    this.renderer = new TableRenderer(\r\n      this.panel,\r\n      this.table,\r\n      this.dashboard.isTimezoneUtc(),\r\n      this.$sanitize,\r\n      this.templateSrv,\r\n      this.col\r\n    )\r\n\r\n    return super.render(this.table)\r\n  }\r\n\r\n  toggleColumnSort (col, colIndex) {\r\n    // remove sort flag from current column\r\n    if (this.table.columns[this.panel.sort.col]) {\r\n      this.table.columns[this.panel.sort.col].sort = false\r\n    }\r\n\r\n    if (this.panel.sort.col === colIndex) {\r\n      if (this.panel.sort.desc) {\r\n        this.panel.sort.desc = false\r\n      } else {\r\n        this.panel.sort.col = null\r\n      }\r\n    } else {\r\n      this.panel.sort.col = colIndex\r\n      this.panel.sort.desc = true\r\n    }\r\n    this.render()\r\n  }\r\n\r\n  exportCsv () {\r\n    const scope = this.$scope.$new(true)\r\n    scope.tableData = this.renderer.render_values()\r\n    scope.panel = 'table'\r\n    this.publishAppEvent('show-modal', {\r\n      templateHtml: '<export-data-modal panel=\"panel\" data=\"tableData\"></export-data-modal>',\r\n      scope,\r\n      modalClass: 'modal--narrow'\r\n    })\r\n  }\r\n\r\n  link (scope, elem, attrs, ctrl) {\r\n    let data\r\n    const panel = ctrl.panel\r\n    let pageCount = 0\r\n\r\n    function getTableHeight () {\r\n      let panelHeight = ctrl.height\r\n\r\n      if (pageCount > 1) {\r\n        panelHeight -= 26\r\n      }\r\n\r\n      return panelHeight - 31 + 'px'\r\n    }\r\n\r\n    function appendTableRows (tbodyElem) {\r\n      ctrl.renderer.setTable(data)\r\n      tbodyElem.empty()\r\n      tbodyElem.html(ctrl.renderer.render(ctrl.pageIndex))\r\n    }\r\n\r\n    function switchPage (e) {\r\n      const el = $(e.currentTarget)\r\n      ctrl.pageIndex = parseInt(el.text(), 10) - 1\r\n      renderPanel()\r\n    }\r\n\r\n    function appendPaginationControls (footerElem) {\r\n      footerElem.empty()\r\n\r\n      const pageSize = panel.pageSize || 100\r\n      pageCount = Math.ceil(data.rows.length / pageSize)\r\n      if (pageCount === 1) {\r\n        return\r\n      }\r\n\r\n      const startPage = Math.max(ctrl.pageIndex - 3, 0)\r\n      const endPage = Math.min(pageCount, startPage + 9)\r\n\r\n      const paginationList = $('<ul></ul>')\r\n\r\n      for (let i = startPage; i < endPage; i++) {\r\n        const activeClass = i === ctrl.pageIndex ? 'active' : ''\r\n        const pageLinkElem = $(\r\n          '<li><a class=\"table-panel-page-link pointer ' + activeClass + '\">' + (i + 1) + '</a></li>'\r\n        )\r\n        paginationList.append(pageLinkElem)\r\n      }\r\n\r\n      footerElem.append(paginationList)\r\n    }\r\n\r\n    function renderPanel () {\r\n      const panelElem = elem.parents('.panel-content')\r\n      const rootElem = elem.find('.table-panel-scroll')\r\n      const tbodyElem = elem.find('tbody')\r\n      const footerElem = elem.find('.table-panel-footer')\r\n\r\n      elem.css({ 'font-size': panel.fontSize })\r\n      panelElem.addClass('table-panel-content')\r\n\r\n      appendTableRows(tbodyElem)\r\n      appendPaginationControls(footerElem)\r\n      const height = parseInt(getTableHeight().split('px')[0]) - 38 + 'px'\r\n      rootElem.css({ 'max-height': panel.scroll ? height : '' })\r\n\r\n      // get current table column dimensions\r\n      if (ctrl.table.columns) {\r\n        ctrl.colDimensions = ctrl.table.columns.filter(x => !x.hidden).map(x => x.text)\r\n      }\r\n    }\r\n\r\n    // hook up link tooltips\r\n    elem.tooltip({\r\n      selector: '[data-link-tooltip]'\r\n    })\r\n\r\n    function addFilterClicked (e) {\r\n      const filterData = $(e.currentTarget).data()\r\n      const options = {\r\n        datasource: panel.datasource,\r\n        key: data.columns[filterData.column].text,\r\n        value: data.rows[filterData.row][filterData.column],\r\n        operator: filterData.operator\r\n      }\r\n\r\n      ctrl.variableSrv.setAdhocFilter(options)\r\n    }\r\n\r\n    elem.on('click', '.table-panel-page-link', switchPage)\r\n    elem.on('click', '.table-panel-filter-link', addFilterClicked)\r\n\r\n    const unbindDestroy = scope.$on('$destroy', () => {\r\n      elem.off('click', '.table-panel-page-link')\r\n      elem.off('click', '.table-panel-filter-link')\r\n      unbindDestroy()\r\n    })\r\n\r\n    ctrl.events.on('render', renderData => {\r\n      data = renderData || data\r\n      if (data) {\r\n        renderPanel()\r\n      }\r\n      ctrl.renderingCompleted()\r\n    })\r\n  }\r\n}\r\n\r\nTableCtrl.templateUrl = 'public/plugins/libre-product-crud-table-panel/partials/module.html'\r\n"]}