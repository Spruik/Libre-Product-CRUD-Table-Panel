{"version":3,"sources":["../src/apis.js"],"names":["getMaterialsToSendList","product","materialsToSend","apps","ingredient","applicators","i","length","app","operationId","k","materials","mat","push","product_id","id","material_id","materialId","operation_id","route_id","quantity","oz","grams_on_scale","gramsOnScale","grams_total","gramsTotal","quantity_uom","sub_sequence_id","seriseId","getProductToSend","comment","product_group","productGroup","product_desc","productDesc","utils","addProductGroup","groupName","success","fail","toSend","group_name","url","postgRestHost","post","JSON","stringify","then","catch","e","updateProductGroup","scope","toBeUpdated","update","toSend1","url1","currentFilterGroup","removeProductGroup","toBeRemoved","removeProductGroupurl","remove","productsByGroupNameUrl","get","ids","res","map","x","proimise","forEach","Promise","all","addProduct","productToSend","matUrl","updateProduct","originalId","originalIngredient","productUrl","hasObjectChanged","deleteUrl","promise","removeProduct"],"mappings":"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","file":"apis.js","sourcesContent":["import * as utils from './utils'\r\n\r\n/**\r\n * Send request to postgrest for adding a product group\r\n * @param {*} groupName The group name\r\n * @param {*} success The success controller\r\n * @param {*} fail The fail controller\r\n */\r\nexport const addProductGroup = (groupName, success, fail) => {\r\n  const toSend = { group_name: groupName }\r\n  const url = utils.postgRestHost + 'product_group'\r\n  utils.post(url, JSON.stringify(toSend)).then(res => {\r\n    success()\r\n  }).catch(e => {\r\n    fail(e)\r\n  })\r\n}\r\n\r\n/**\r\n * Send request to postgrest for updating a product group and all its children's product group name\r\n * @param {*} toBeUpdated The group to be updated\r\n * @param {*} groupName The group name\r\n * @param {*} success The success controller\r\n * @param {*} fail The fail controller\r\n */\r\nexport const updateProductGroup = (scope, toBeUpdated, groupName, success, fail) => {\r\n  const toSend = { group_name: groupName }\r\n  const url = `${utils.postgRestHost}product_group?group_name=eq.${toBeUpdated}`\r\n  utils.update(url, JSON.stringify(toSend)).then(res => {\r\n    const toSend1 = { product_group: groupName }\r\n    const url1 = `${utils.postgRestHost}product?product_group=eq.${toBeUpdated}`\r\n    utils.update(url1, JSON.stringify(toSend1)).then(() => {\r\n      scope.currentFilterGroup = groupName // update the current filter so that the filter input will not be empty\r\n      success()\r\n    }).catch(e => {\r\n      fail(e)\r\n    })\r\n  }).catch(e => {\r\n    fail(e)\r\n  })\r\n}\r\n\r\n/**\r\n * Send request to postgrest for removing a product group and all its children\r\n * @param {*} toBeRemoved The group to be removed\r\n * @param {*} success The success controller\r\n * @param {*} fail The fail controller\r\n */\r\nexport const removeProductGroup = (toBeRemoved, success, fail) => {\r\n  // first of all remove the product group\r\n  const removeProductGroupurl = `${utils.postgRestHost}product_group?group_name=eq.${toBeRemoved}`\r\n  utils.remove(removeProductGroupurl).then(() => {\r\n    // then use the 'toberemoved' to get the product id\r\n    const productsByGroupNameUrl = `${utils.postgRestHost}product?product_group=eq.${toBeRemoved}`\r\n    utils.get(productsByGroupNameUrl).then(res => {\r\n      const ids = res.map(x => x.id)\r\n      if (ids.length === 0) {\r\n        // if cannot get anything\r\n        success()\r\n      } else {\r\n        // if can get something\r\n        // use the product group to remove the product\r\n        utils.remove(productsByGroupNameUrl).then(() => {\r\n          // use the product id to remove the material requirements\r\n          const proimise = []\r\n          ids.forEach(id => {\r\n            proimise.push(utils.remove(`${utils.postgRestHost}material_requirement?product_id=eq.${id}`))\r\n          })\r\n          Promise.all(proimise).then(() => { success() }).catch(e => { fail(e) })\r\n        }).catch(e => { fail(e) })\r\n      }\r\n    }).catch(e => { fail(e) })\r\n  }).catch(e => { fail(e) })\r\n}\r\n\r\n/**\r\n * Send request to postgrest for adding a product\r\n * @param {*} product The product to be inserted\r\n * @param {*} success What to do when the request is successful? give me a func\r\n * @param {*} fail What to do when the request is failed? give me a func\r\n */\r\nexport const addProduct = (product, success, fail) => {\r\n  const productToSend = getProductToSend(product)\r\n  const materialsToSend = getMaterialsToSendList(product)\r\n\r\n  const url = utils.postgRestHost + 'product'\r\n  const matUrl = utils.postgRestHost + 'material_requirement'\r\n  utils.post(url, JSON.stringify(productToSend)).then(() => {\r\n    utils.post(matUrl, JSON.stringify(materialsToSend)).then(() => {\r\n      success()\r\n    }).catch(e => {\r\n      fail(e)\r\n    })\r\n  }).catch(e => {\r\n    fail(e)\r\n  })\r\n}\r\n\r\n/**\r\n * Send request to postgrest for updating a product\r\n * @param {*} originalId The original id for locating the product to be updated\r\n * @param {*} originalIngredient The original ingredient\r\n * @param {*} product The new product data you get from the form\r\n * @param {*} success What to do when the request is successful? give me a func\r\n * @param {*} fail What to do when the request is failed? give me a func\r\n */\r\nexport const updateProduct = (originalId, originalIngredient, product, success, fail) => {\r\n  const productToSend = getProductToSend(product)\r\n  const productUrl = `${utils.postgRestHost}product?id=eq.${originalId}`\r\n\r\n  if (!utils.hasObjectChanged(originalIngredient, product.ingredient) && originalId === product.id) {\r\n    // ingredient not changed and id not changed just update the product table\r\n    utils.update(productUrl, JSON.stringify(productToSend)).then(() => {\r\n      success()\r\n    }).catch(e => {\r\n      fail(e)\r\n    })\r\n  } else {\r\n    // ingredient changed, update the product table\r\n    // remove all material requirements that match the product id\r\n    // re-insert the new material requirements\r\n    const materialsToSend = getMaterialsToSendList(product)\r\n    const deleteUrl = `${utils.postgRestHost}material_requirement?product_id=eq.${originalId}`\r\n    const matUrl = `${utils.postgRestHost}material_requirement`\r\n    const promise = [\r\n      utils.update(productUrl, JSON.stringify(productToSend)),\r\n      utils.remove(deleteUrl)\r\n    ]\r\n\r\n    Promise.all(promise).then(() => {\r\n      utils.post(matUrl, JSON.stringify(materialsToSend)).then(() => {\r\n        success()\r\n      }).catch(e => {\r\n        fail(e)\r\n      })\r\n    }).catch(e => {\r\n      fail(e)\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * Send request to postgrest for removing a product\r\n * @param {*} id The id of the product to be removed\r\n * @param {*} success What to do when the request is successful? give me a func\r\n * @param {*} fail What to do when the request is failed? give me a func\r\n */\r\nexport const removeProduct = (id, success, fail) => {\r\n  const url = `${utils.postgRestHost}product?id=eq.${id}`\r\n  const matUrl = `${utils.postgRestHost}material_requirement?product_id=eq.${id}`\r\n\r\n  const promise = [\r\n    utils.remove(url),\r\n    utils.remove(matUrl)\r\n  ]\r\n\r\n  Promise.all(promise).then(() => {\r\n    success()\r\n  }).catch(e => {\r\n    fail(e)\r\n  })\r\n}\r\n\r\nfunction getMaterialsToSendList (product) {\r\n  const materialsToSend = []\r\n  const apps = product.ingredient.applicators\r\n  for (let i = 0; i < apps.length; i++) {\r\n    const app = apps[i]\r\n    const operationId = app.operationId\r\n    for (let k = 0; k < app.materials.length; k++) {\r\n      const mat = app.materials[k]\r\n      materialsToSend.push({\r\n        product_id: product.id,\r\n        material_id: mat.materialId,\r\n        operation_id: operationId,\r\n        route_id: null,\r\n        quantity: mat.oz,\r\n        grams_on_scale: mat.gramsOnScale,\r\n        grams_total: mat.gramsTotal,\r\n        quantity_uom: 'Oz',\r\n        sub_sequence_id: mat.seriseId\r\n      })\r\n    }\r\n  }\r\n  return materialsToSend\r\n}\r\n\r\nfunction getProductToSend (product) {\r\n  return {\r\n    id: product.id,\r\n    ingredient: product.ingredient,\r\n    comment: product.comment,\r\n    product_group: product.productGroup,\r\n    product_desc: product.productDesc\r\n  }\r\n}\r\n"]}