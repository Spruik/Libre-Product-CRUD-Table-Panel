{"version":3,"sources":["../src/product_form.js"],"names":["showProductForm","tableCtrl","allData","rowData","isUpdating","id","desc","utils","showModal","removeListeners","addListeners","$","document","off","on","inputs","serializeArray","value","spaceCheck","isInputsValid","updateProduct","addProduct","alert","ids","reduce","arr","d","product_id","parseInt","push","indexOf","ctrl","line","url","postgRestHost","post","then","trigger","refresh","catch","data","update"],"mappings":"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","file":"product_form.js","sourcesContent":["import * as utils from './utils'\n\nlet isUpdating\n\nexport function showProductForm(tableCtrl, allData, rowData) {\n  \n  isUpdating = false\n  let id\n  let desc = ''\n  \n  if (rowData) {\n    id = rowData[0]\n    desc = rowData[1]\n    isUpdating = true\n  }\n\n  utils.showModal('product_form.html', {id: id, desc:desc})\n  removeListeners()\n  addListeners(tableCtrl, allData, rowData)\n}\n\nfunction removeListeners(){\n  $(document).off('click', '#master-data-product-submitBtn')\n}\n\nfunction addListeners(tableCtrl, allData, rowData){\n  $(document).on('click', '#master-data-product-submitBtn', e => {\n    const inputs = $('#master-data-product-form').serializeArray()\n    //remove spaces in the back of the product description if there is\n    inputs[1].value = utils.spaceCheck(inputs[1].value)\n    if (isInputsValid(inputs, allData, rowData)) {\n      if (isUpdating) {\n        updateProduct(inputs, rowData, tableCtrl)\n      }else {\n        addProduct(inputs, tableCtrl)\n      }\n    }\n  })\n}\n\nfunction isInputsValid(inputs, allData, rowData){\n  if (inputs[0].value === '' || inputs[1].value === '') {\n    utils.alert('warning', 'Warning', 'All fields are required')\n    return false\n  }\n\n  let ids\n\n  if (isUpdating) {\n    ids = allData.reduce((arr, d) => {\n      if (d.product_id !== parseInt(rowData[0])) {\n        arr.push(d.product_id)\n      }\n      return arr\n    }, [])\n  }else {\n    ids = allData.reduce((arr, d) => {\n      arr.push(d.product_id)\n      return arr\n    }, [])\n  }\n\n  if (ids.indexOf(parseInt(inputs[0].value)) !== -1) {\n    utils.alert('warning', 'Warning', 'Product exists')\n    return false\n  }\n\n  return true\n}\n\nfunction addProduct(inputs, ctrl){\n  const line = 'product_id=' + inputs[0].value + '&product_desc=' + inputs[1].value\n  const url = utils.postgRestHost + 'products'\n  utils.post(url, line).then(res => {\n    // console.log(res)\n    $('#master-data-product-cancelBtn').trigger('click')\n    utils.alert('success', 'Success', 'Product has been added')\n    ctrl.refresh()\n  }).catch(e => {\n    // console.log(e)\n    $('#master-data-product-cancelBtn').trigger('click')\n    utils.alert('error', 'Error', 'Error occurred while adding the product to the database, please try again')\n  })\n}\n\nfunction updateProduct(inputs, data, ctrl) {\n  const url = utils.postgRestHost + 'products?product_id=eq.' + data[0] + '&product_desc=eq.' + data[1]\n  const line = 'product_id=' + inputs[0].value + '&product_desc=' + inputs[1].value\n  utils.update(url, line).then(res => {\n    // console.log(res)\n    $('#master-data-product-cancelBtn').trigger('click')\n    utils.alert('success', 'Success', 'Product has been updated')\n    ctrl.refresh()\n  }).catch(e => {\n    // console.log(e)\n    $('#master-data-product-cancelBtn').trigger('click')\n    utils.alert('error', 'Error', 'Error occurred while updating the product to the database, please try again')\n  })\n}"]}